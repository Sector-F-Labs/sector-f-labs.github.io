<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Sector F Labs</title>
        <link rel="icon" type="image/png" href="logo-nocircle.png" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta
            name="description"
            content="Sector F Labs is a space for bold experimentation and beautifully simple tools. We break traditional molds to build systems that are powerful, privacy-respecting, and human-centered."
        />
        <meta property="og:title" content="Sector F Labs" />
        <meta
            property="og:description"
            content="Sector F Labs is a space for bold experimentation and beautifully simple tools. We break traditional molds to build systems that are powerful, privacy-respecting, and human-centered."
        />
        <meta property="og:image" content="logo.png" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://sectorflabs.com/" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content="Sector F Labs" />
        <meta
            name="twitter:description"
            content="Sector F Labs is a space for bold experimentation and beautifully simple tools."
        />
        <meta name="twitter:image" content="logo.png" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="/style.css" />

        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
    </head>
    <body>
        <header>
            <a href="/index.html">
                <img
                    class="invert"
                    src="/logo-transparent.png"
                    alt="Sector F Logo"
                />
                <h1>Sector F Labs</h1>
            </a>
        </header>

        <div class="layout-container">
            <nav>
                <ul>
                    <li><a href="/projects/exp-013-service-pipe">exp-013-service-pipe</a></li>
<li><a href="/projects/reservoir">Reservoir</a></li>
<li><a href="/projects/md-chat">md-chat</a></li>
                </ul>
            </nav>

            <main><div class="github-link">
                <p><strong><i class="fab fa-github"></i> GitHub Repository:</strong> <a href="https://github.com/Sector-F-Labs/exp-013-service-pipe" target="_blank" rel="noopener noreferrer">https://github.com/Sector-F-Labs/exp-013-service-pipe</a></p>
            </div>
            <hr style="margin: 2rem 0;"><h1>Service Pipe Architecture (exp-013)</h1>
<h2>Experiment Details</h2>
<p>| Item | Value |
| --- | --- |
| Experiment | exp-013 |
| Status | Proposed |
| Author | Divan Visagie |
| Date | 03/06/2025 |</p>
<h2>Abstract</h2>
<p>This project explores composing independent services using simple Unix-style pipes. Each service communicates via a lightweight JSON Lines (JSONL) protocol. By tagging every message with a <code>type</code> and optional <code>correlationId</code>, these services can be rearranged without changing code. The experiment demonstrates this approach by building a Telegram bot pipeline.</p>
<h2>Motivation</h2>
<p>Modern systems often require complex network setups to connect small services. Using Unix pipes and a single streaming format simplifies this. With one protocol and small utilities, we can chain tools together much like classic shell commands.</p>
<h2>Hypothesis</h2>
<p>If each service accepts and emits JSONL streams, pipelines become easy to reconfigure. We expect a modular and language‑agnostic system that handles batch or continuous data equally well.</p>
<h2>Methodology</h2>
<p>The experiment chains services together with <code>|</code> while ensuring each command reads and writes JSONL. Observations and logs live under <code>logs/</code> with ISO date names.</p>
<h3>Primary Demonstration Pipeline</h3>
<div class="code-block"><pre><button class="copy-btn">Copy</button><code>telegram-in \
| auth-service \
| capability-dispatcher --capabilities 'canned-responder;llm-responder' \
| load-balancer --workers 4 \
| parallel --jobs 4 --pipe --line-buffer 'llm-proxy | response-formatter' \
| telegram-out
</code></pre></div>
<div class="code-block"><pre><button class="copy-btn">Copy</button><code>flowchart LR
  A[telegram-in] --&gt; B[auth-service]
  B --&gt; C[capability-dispatcher]
  C --&gt; D[load-balancer]
  D --&gt; P
  subgraph P[parallel]
    E[llm-proxy] --&gt; F[response-formatter]
  end
  P --&gt; G[telegram-out]
</code></pre></div>
<h4>telegram-in</h4>
<p>Receives messages from Kafka and converts them to the experiment format.</p>
<h4>auth-service</h4>
<p>Checks user permissions and enriches messages.</p>
<h4>capability-dispatcher</h4>
<p>Routes requests to canned or LLM responders.</p>
<h4>load-balancer</h4>
<p>Assigns a <code>workerId</code> so parallel workers know which messages to handle.</p>
<h4>parallel block</h4>
<p>Runs <code>llm-proxy</code> and <code>response-formatter</code> concurrently.</p>
<h4>telegram-out</h4>
<p>Publishes final responses back to Kafka.</p>
<h3>Environment Variables for Telegram Adapters</h3>
<p>| Variable | Purpose | Default |
| --- | --- | --- |
| <code>KAFKA_BROKERS</code> | Comma separated broker list | – |
| <code>KAFKA_IN_TOPIC</code> | Topic consumed by <code>telegram-in</code> | <code>telegram_in</code> |
| <code>KAFKA_OUT_TOPIC</code> | Topic produced by <code>telegram-out</code> | <code>telegram_out</code> |</p>
<h2>Pipe Protocol</h2>
<p>Every JSONL message follows a small set of fields.</p>
<h3>JSON Lines</h3>
<p>Each line is a complete JSON object. The newline separates messages.</p>
<h3>Message Fields</h3>
<p>| Field | Purpose | Required |
| --- | --- | --- |
| <code>type</code> | Identifies the message so services know if they should act | Yes |
| <code>correlationId</code> | Traces a request through the pipeline | Recommended |
| <code>workerId</code> | Marks which worker should handle the message | Optional |</p>
<h3>Processing and Forwarding</h3>
<p>Services check <code>type</code> (and <code>workerId</code> when set). They modify or pass through messages, always preserving the JSONL format.</p>
<h3>Additional Utilities</h3>
<p>Utilities like <code>jsonl-wrap</code> or <code>load-balancer</code> help integrate regular commands and balance work across parallel processes.</p>
<h2>Success Criteria</h2>
<ul>
<li>The Telegram pipeline runs end to end.</li>
<li><code>type</code> and <code>correlationId</code> allow tracing and routing.</li>
<li><code>parallel</code> improves throughput for LLM calls.</li>
<li><code>jsonl-wrap</code> successfully wraps arbitrary commands.</li>
<li>The order of services can change without redeployment.</li>
<li>Long-running pipelines support both batch and streaming modes.</li>
</ul>
<h2>Challenges</h2>
<ul>
<li>Keeping strict JSONL formatting across every service.</li>
<li>Managing backpressure when parts of the pipeline run slower.</li>
<li>Overhead from launching many short-lived processes.</li>
<li>Building a robust <code>load-balancer</code> that handles failures gracefully.</li>
<li>Debugging output from multiple concurrent workers.</li>
</ul>
<h2>Expected Outcome</h2>
<p>This approach should enable highly composable and modular architectures that leverage existing Unix tools. We expect insights into efficient scaling patterns for both batch and continuous workloads.</p>
<h2>Next Steps</h2>
<ul>
<li>Finalize utilities like <code>jsonl-wrap</code> and <code>load-balancer</code>.</li>
<li>Define a standard JSONL command protocol.</li>
<li>Create schemas for common message <code>type</code> values.</li>
<li>Build additional monitoring and debugging helpers.</li>
<li>Explore dynamic service discovery and more flexible orchestration.</li>
</ul>
<h2>References</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Unix_philosophy">Unix Philosophy and IPC via pipes</a></li>
<li><a href="https://jsonlines.org/">JSON Lines Specification</a></li>
<li><a href="https://www.gnu.org/software/parallel/">GNU Parallel documentation</a></li>
<li><a href="https://microservices.io/">Microservices Architecture patterns</a></li>
<li><a href="https://martinfowler.com/articles/201701-event-driven.html">Event-Driven Architecture</a></li>
<li><a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/PipesAndFilters.html">Unix Pipes and Filters pattern</a></li>
</ul>
</main>

            <div class="spacer"></div>
        </div>

        <footer>
            <p>
                <span class="github-footer"><a href="https://github.com/Sector-F-Labs"><i class="fa-brands fa-github"></i> Sector-F-Labs</a></span>
                <span class="copyright">&copy; 2025 Sector F Labs. All rights reserved.</span>
            </p>
        </footer>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                document.querySelectorAll(".copy-btn").forEach(function (btn) {
                    btn.addEventListener("click", function (e) {
                        e.preventDefault();
                        var pre = btn.closest("pre");
                        if (!pre) return;
                        // Get all code text inside the pre
                        var code = pre.querySelector("code");
                        var text = code ? code.innerText : pre.innerText;
                        navigator.clipboard.writeText(text);
                        btn.textContent = "Copied!";
                        setTimeout(function () {
                            btn.textContent = "Copy";
                        }, 1200);
                    });
                });
            });
        </script>
    </body>
</html>
